---
- name: Create local munge directory
  ansible.builtin.file:
    path: "{{ slurm_local_munge_dir }}"
    state: directory
    recurse: true

- name: Generate munge key
  ansible.builtin.command:
    cmd: "dd if=/dev/urandom of={{ slurm_local_munge_dir }}/munge.key bs=1 count=1024"
    creates: "{{ slurm_local_munge_dir }}/munge.key"

- name: Create local mariadb directory
  ansible.builtin.file:
    path: "{{ slurm_local_mariadb_dir }}"
    state: directory
    recurse: true

- name: Generate slurm MariaDB password file
  ansible.builtin.copy:
    content: "{{ lookup('community.general.random_string', length=16, special=false) }}" # avoid special character that may confuse either slurmdbd or mariadb
    dest: "{{ slurm_local_mariadb_dir }}/mariadb.password"
    force: no  # do not overwrite the password if it has already been generated
